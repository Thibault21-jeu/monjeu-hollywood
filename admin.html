<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HollyBlood - Admin</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      background-color: #1C1C1C;
      color: #F4F4F4;
      font-family: 'Inter', sans-serif;
      padding: 2rem;
    }

    h1 {
      font-size: 2rem;
      color: #C9A227;
      margin-bottom: 1rem;
      font-family: 'Playfair Display', serif;
    }

    .section {
      margin-bottom: 2rem;
      background: #2A2A2A;
      padding: 1rem;
      border-radius: 10px;
    }

    .section h2 {
      color: #F4F4F4;
      font-size: 1.3rem;
      margin-bottom: 1rem;
      border-bottom: 1px solid #444;
      padding-bottom: 0.5rem;
    }

    .party {
      border-bottom: 1px solid #444;
      padding: 0.5rem 0;
    }

    .btn {
      background-color: #D41427;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      margin-top: 1rem;
    }

    .btn:hover {
      background-color: #e02a3b;
    }

    .small {
      font-size: 0.9rem;
      color: #aaa;
    }

    pre {
      background: #111;
      color: #0f0;
      padding: 1rem;
      border-radius: 6px;
      overflow-x: auto;
      font-size: 0.8rem;
    }
  </style>
</head>
<body>

  <h1>🎬 Interface Admin HollyBlood</h1>

  <div class="section" id="stats">
    <h2>📊 Statistiques globales</h2>
    <p id="nbParties">Parties enregistrées : 0</p>
    <p id="nbJoueurs">Joueurs enregistrés : 0</p>
    <p id="nbIncompletes">Parties incomplètes : 0</p>
  </div>

  <div class="section" id="listeParties">
    <h2>🎟️ Parties en cours</h2>
    <!-- Liste des parties générée ici -->
  </div>

  <div class="section">
    <h2>🛠️ Outils admin</h2>
    <button class="btn" onclick="supprimerPartiesVides()">🧹 Supprimer parties sans joueurs</button>
    <button class="btn" onclick="toutEffacer()">❌ Réinitialiser tout</button>
    <button class="btn" onclick="exporterJSON()">📦 Exporter les données</button>
    <pre id="jsonExport" style="display:none;"></pre>
  </div>

  <script>
    function chargerAdmin() {
      const parties = JSON.parse(localStorage.getItem("parties") || "{}");
      let totalJoueurs = 0;
      let incompletes = 0;
      const conteneur = document.getElementById("listeParties");
      conteneur.innerHTML = "";

      for (const code in parties) {
        const scene = parties[code];
        const joueurs = JSON.parse(localStorage.getItem("joueurs-" + code) || "[]");

        totalJoueurs += joueurs.length;
        if (joueurs.length < 3) incompletes++;

        const div = document.createElement("div");
        div.className = "party";
        div.innerHTML = `
          <strong>🎫 Code : ${code}</strong> — ${scene}<br />
          👥 ${joueurs.length} joueur(s)
          <div class="small">${joueurs.map(j => `🎭 ${j.perso} (${j.role || "?"}${j.role === "meurtrier" ? " – 🩸" : ""}${j.mobile ? ", " + j.mobile : ""})`).join("<br>")}</div>
          <button class="btn" onclick="supprimerPartie('${code}')">🗑️ Supprimer</button>
        `;
        conteneur.appendChild(div);
      }

      document.getElementById("nbParties").innerText = "Parties enregistrées : " + Object.keys(parties).length;
      document.getElementById("nbJoueurs").innerText = "Joueurs enregistrés : " + totalJoueurs;
      document.getElementById("nbIncompletes").innerText = "Parties incomplètes (<3 joueurs) : " + incompletes;
    }

    function supprimerPartie(code) {
      const parties = JSON.parse(localStorage.getItem("parties") || "{}");
      delete parties[code];
      localStorage.removeItem("joueurs-" + code);
      localStorage.setItem("parties", JSON.stringify(parties));
      chargerAdmin();
    }

    function supprimerPartiesVides() {
      const parties = JSON.parse(localStorage.getItem("parties") || "{}");
      for (const code in parties) {
        const joueurs = JSON.parse(localStorage.getItem("joueurs-" + code) || "[]");
        if (joueurs.length === 0) {
          delete parties[code];
          localStorage.removeItem("joueurs-" + code);
        }
      }
      localStorage.setItem("parties", JSON.stringify(parties));
      chargerAdmin();
    }

    function toutEffacer() {
      if (confirm("⚠️ Cela supprimera toutes les données locales. Continuer ?")) {
        localStorage.clear();
        chargerAdmin();
      }
    }

    function exporterJSON() {
      const data = {
        parties: JSON.parse(localStorage.getItem("parties") || "{}")
      };

      for (const code in data.parties) {
        data["joueurs-" + code] = JSON.parse(localStorage.getItem("joueurs-" + code) || "[]");
      }

      const json = JSON.stringify(data, null, 2);
      const pre = document.getElementById("jsonExport");
      pre.textContent = json;
      pre.style.display = "block";
    }

    chargerAdmin();
  </script>

</body>
</html>
